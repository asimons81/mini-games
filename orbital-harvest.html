<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orbital Harvest</title>
  <style>
    :root {
      --bg1: #08111f;
      --bg2: #1a0f2e;
      --ink: #ecf6ff;
      --accent: #57f2c5;
      --danger: #ff6470;
      --gold: #ffd166;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background:
        radial-gradient(circle at 20% 20%, #1f3a63 0%, transparent 45%),
        radial-gradient(circle at 75% 30%, #3f246f 0%, transparent 40%),
        linear-gradient(140deg, var(--bg1), var(--bg2));
      color: var(--ink);
      font-family: "Trebuchet MS", "Segoe UI", sans-serif;
      padding: 12px;
    }

    .game-wrap {
      width: min(920px, 100%);
      display: grid;
      gap: 10px;
    }

    .hud {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: space-between;
      align-items: center;
      font-size: 0.95rem;
      letter-spacing: 0.03em;
    }

    .pill {
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(3px);
    }

    canvas {
      width: 100%;
      max-height: 75vh;
      aspect-ratio: 16 / 9;
      display: block;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 18px 42px rgba(0, 0, 0, 0.45);
      background: radial-gradient(circle at 50% 50%, #131f33 10%, #060b16 75%);
    }

    .help {
      opacity: 0.9;
      line-height: 1.4;
      font-size: 0.92rem;
    }

    kbd {
      border: 1px solid rgba(255, 255, 255, 0.4);
      border-bottom-width: 2px;
      border-radius: 5px;
      padding: 1px 5px;
      font-size: 0.86rem;
      background: rgba(255, 255, 255, 0.08);
    }
  </style>
</head>
<body>
  <div class="game-wrap">
    <div class="hud">
      <div class="pill">Score: <strong id="score">0</strong></div>
      <div class="pill">Time: <strong id="time">60</strong>s</div>
      <div class="pill">Lives: <strong id="lives">3</strong></div>
      <div class="pill">Power: <strong id="power">None</strong></div>
    </div>

    <canvas id="game" width="960" height="540" aria-label="Orbital Harvest game"></canvas>

    <div class="help">
      Pilot your drone to harvest star fragments and avoid drifting debris.<br />
      <kbd>WASD</kbd>/<kbd>Arrow Keys</kbd> move, <kbd>Shift</kbd> dash, <kbd>R</kbd> restart after game over.
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const hud = {
      score: document.getElementById("score"),
      time: document.getElementById("time"),
      lives: document.getElementById("lives"),
      power: document.getElementById("power")
    };

    const keys = new Set();
    const rand = (a, b) => Math.random() * (b - a) + a;

    const state = {
      running: true,
      score: 0,
      time: 60,
      lives: 3,
      shake: 0,
      t: 0
    };

    const player = {
      x: canvas.width / 2,
      y: canvas.height / 2,
      vx: 0,
      vy: 0,
      r: 15,
      speed: 260,
      friction: 0.88,
      invuln: 0,
      dash: 0,
      dashCooldown: 0,
      magnet: 0,
      shield: 0
    };

    const stars = [];
    const debris = [];
    const particles = [];
    const powerups = [];

    function spawnStar() {
      stars.push({ x: rand(30, canvas.width - 30), y: rand(30, canvas.height - 30), r: rand(5, 9), spin: rand(0, Math.PI * 2) });
    }

    function spawnDebris() {
      const speed = rand(70, 165);
      const ang = rand(0, Math.PI * 2);
      debris.push({
        x: rand(15, canvas.width - 15),
        y: rand(15, canvas.height - 15),
        vx: Math.cos(ang) * speed,
        vy: Math.sin(ang) * speed,
        r: rand(11, 20)
      });
    }

    function spawnPowerup() {
      const types = ["magnet", "shield", "time", "burst"];
      powerups.push({
        x: rand(40, canvas.width - 40),
        y: rand(40, canvas.height - 40),
        r: 12,
        type: types[Math.floor(Math.random() * types.length)],
        ttl: 12
      });
    }

    for (let i = 0; i < 14; i++) spawnStar();
    for (let i = 0; i < 6; i++) spawnDebris();

    addEventListener("keydown", (e) => {
      if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight", " "].includes(e.key)) e.preventDefault();
      keys.add(e.key.toLowerCase());

      if (!state.running && e.key.toLowerCase() === "r") restart();
    });

    addEventListener("keyup", (e) => keys.delete(e.key.toLowerCase()));

    function restart() {
      state.running = true;
      state.score = 0;
      state.time = 60;
      state.lives = 3;
      state.shake = 0;
      state.t = 0;

      player.x = canvas.width / 2;
      player.y = canvas.height / 2;
      player.vx = player.vy = 0;
      player.invuln = player.magnet = player.shield = player.dash = player.dashCooldown = 0;

      stars.length = 0;
      debris.length = 0;
      powerups.length = 0;
      particles.length = 0;

      for (let i = 0; i < 14; i++) spawnStar();
      for (let i = 0; i < 6; i++) spawnDebris();
    }

    function circleHit(a, b) {
      const dx = a.x - b.x;
      const dy = a.y - b.y;
      return dx * dx + dy * dy < (a.r + b.r) * (a.r + b.r);
    }

    function emit(x, y, count, color, speed = 120) {
      for (let i = 0; i < count; i++) {
        const ang = rand(0, Math.PI * 2);
        const s = rand(speed * 0.4, speed);
        particles.push({ x, y, vx: Math.cos(ang) * s, vy: Math.sin(ang) * s, life: rand(0.25, 0.8), color });
      }
    }

    function update(dt) {
      if (!state.running) return;

      state.t += dt;
      state.time -= dt;
      if (state.time <= 0 || state.lives <= 0) {
        state.running = false;
        return;
      }

      if (Math.random() < 0.65 * dt && stars.length < 22) spawnStar();
      if (Math.random() < 0.18 * dt && debris.length < 11) spawnDebris();
      if (Math.random() < 0.08 * dt && powerups.length < 2) spawnPowerup();

      let ax = 0;
      let ay = 0;
      if (keys.has("arrowup") || keys.has("w")) ay -= 1;
      if (keys.has("arrowdown") || keys.has("s")) ay += 1;
      if (keys.has("arrowleft") || keys.has("a")) ax -= 1;
      if (keys.has("arrowright") || keys.has("d")) ax += 1;

      const len = Math.hypot(ax, ay) || 1;
      ax /= len; ay /= len;

      let speed = player.speed;
      if (player.dash > 0) speed *= 2.1;
      player.vx += ax * speed * dt;
      player.vy += ay * speed * dt;

      if (keys.has("shift") && player.dashCooldown <= 0) {
        player.dash = 0.2;
        player.dashCooldown = 1.2;
      }

      player.dash = Math.max(0, player.dash - dt);
      player.dashCooldown = Math.max(0, player.dashCooldown - dt);
      player.magnet = Math.max(0, player.magnet - dt);
      player.shield = Math.max(0, player.shield - dt);
      player.invuln = Math.max(0, player.invuln - dt);
      state.shake = Math.max(0, state.shake - dt * 5);

      player.vx *= Math.pow(player.friction, dt * 60);
      player.vy *= Math.pow(player.friction, dt * 60);

      player.x += player.vx * dt;
      player.y += player.vy * dt;

      player.x = Math.max(player.r, Math.min(canvas.width - player.r, player.x));
      player.y = Math.max(player.r, Math.min(canvas.height - player.r, player.y));

      for (const d of debris) {
        d.x += d.vx * dt;
        d.y += d.vy * dt;
        if (d.x < d.r || d.x > canvas.width - d.r) d.vx *= -1;
        if (d.y < d.r || d.y > canvas.height - d.r) d.vy *= -1;

        if (circleHit(player, d) && player.invuln <= 0) {
          if (player.shield > 0) {
            player.shield = 0;
            player.invuln = 0.7;
            emit(d.x, d.y, 16, "#80f6ff", 230);
          } else {
            state.lives -= 1;
            player.invuln = 1.15;
            state.shake = 1;
            emit(player.x, player.y, 20, "#ff6f7f", 240);
          }
        }
      }

      for (let i = stars.length - 1; i >= 0; i--) {
        const s = stars[i];
        s.spin += dt * 4;
        if (player.magnet > 0) {
          const dx = player.x - s.x;
          const dy = player.y - s.y;
          const dist = Math.hypot(dx, dy) || 1;
          if (dist < 220) {
            s.x += (dx / dist) * 240 * dt;
            s.y += (dy / dist) * 240 * dt;
          }
        }

        if (circleHit(player, s)) {
          state.score += 10;
          state.time = Math.min(99, state.time + 0.4);
          emit(s.x, s.y, 8, "#ffe08a", 140);
          stars.splice(i, 1);
        }
      }

      for (let i = powerups.length - 1; i >= 0; i--) {
        const p = powerups[i];
        p.ttl -= dt;
        if (p.ttl <= 0) {
          powerups.splice(i, 1);
          continue;
        }
        if (circleHit(player, p)) {
          if (p.type === "magnet") player.magnet = 8;
          if (p.type === "shield") player.shield = 10;
          if (p.type === "time") state.time += 8;
          if (p.type === "burst") {
            state.score += 20;
            for (let k = 0; k < 3; k++) spawnStar();
          }
          emit(p.x, p.y, 20, "#6df8cc", 190);
          powerups.splice(i, 1);
        }
      }

      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.life -= dt;
        p.x += p.vx * dt;
        p.y += p.vy * dt;
        p.vx *= 0.96;
        p.vy *= 0.96;
        if (p.life <= 0) particles.splice(i, 1);
      }

      hud.score.textContent = state.score;
      hud.time.textContent = Math.max(0, Math.ceil(state.time));
      hud.lives.textContent = state.lives;
      hud.power.textContent = player.shield > 0 ? "Shield" : player.magnet > 0 ? "Magnet" : "None";
    }

    function draw() {
      ctx.save();
      if (state.shake > 0) {
        const s = state.shake * 6;
        ctx.translate(rand(-s, s), rand(-s, s));
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let i = 0; i < 100; i++) {
        const x = (i * 97) % canvas.width;
        const y = (i * 157 + state.t * 8) % canvas.height;
        ctx.fillStyle = `rgba(220,235,255,${0.1 + (i % 5) * 0.08})`;
        ctx.fillRect(x, y, 2, 2);
      }

      for (const s of stars) {
        ctx.save();
        ctx.translate(s.x, s.y);
        ctx.rotate(s.spin);
        ctx.fillStyle = "#ffd166";
        ctx.beginPath();
        for (let i = 0; i < 5; i++) {
          const a = i * (Math.PI * 2) / 5;
          const r = i % 2 === 0 ? s.r + 3 : s.r - 1;
          ctx.lineTo(Math.cos(a) * r, Math.sin(a) * r);
        }
        ctx.closePath();
        ctx.fill();
        ctx.restore();
      }

      for (const d of debris) {
        ctx.fillStyle = "#7f8ca6";
        ctx.beginPath();
        ctx.arc(d.x, d.y, d.r, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "rgba(255,255,255,0.18)";
        ctx.beginPath();
        ctx.arc(d.x - d.r * 0.3, d.y - d.r * 0.3, d.r * 0.35, 0, Math.PI * 2);
        ctx.fill();
      }

      for (const p of powerups) {
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(state.t * 3);
        ctx.strokeStyle = p.type === "magnet" ? "#57f2c5" : p.type === "shield" ? "#80f6ff" : p.type === "time" ? "#ffc06f" : "#ff7ac6";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.rect(-9, -9, 18, 18);
        ctx.stroke();
        ctx.restore();
      }

      for (const p of particles) {
        ctx.fillStyle = p.color;
        ctx.globalAlpha = Math.max(0, p.life * 1.4);
        ctx.fillRect(p.x, p.y, 3, 3);
      }
      ctx.globalAlpha = 1;

      ctx.save();
      ctx.translate(player.x, player.y);
      const blink = player.invuln > 0 && Math.floor(state.t * 20) % 2 === 0;
      if (!blink) {
        if (player.shield > 0) {
          ctx.strokeStyle = "rgba(128,246,255,0.8)";
          ctx.lineWidth = 3;
          ctx.beginPath();
          ctx.arc(0, 0, player.r + 6, 0, Math.PI * 2);
          ctx.stroke();
        }

        ctx.fillStyle = player.magnet > 0 ? "#57f2c5" : "#ecf6ff";
        ctx.beginPath();
        ctx.moveTo(18, 0);
        ctx.lineTo(-12, -10);
        ctx.lineTo(-8, 0);
        ctx.lineTo(-12, 10);
        ctx.closePath();
        ctx.fill();
      }
      ctx.restore();

      if (!state.running) {
        ctx.fillStyle = "rgba(0,0,0,0.58)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#fff";
        ctx.textAlign = "center";
        ctx.font = "700 58px Trebuchet MS";
        ctx.fillText("Mission Over", canvas.width / 2, canvas.height / 2 - 20);
        ctx.font = "600 32px Trebuchet MS";
        ctx.fillStyle = "#ffd166";
        ctx.fillText(`Final Score: ${state.score}`, canvas.width / 2, canvas.height / 2 + 30);
        ctx.font = "500 22px Trebuchet MS";
        ctx.fillStyle = "#e6f1ff";
        ctx.fillText("Press R to relaunch", canvas.width / 2, canvas.height / 2 + 72);
      }

      ctx.restore();
    }

    let last = performance.now();
    function loop(now) {
      const dt = Math.min(0.033, (now - last) / 1000);
      last = now;
      update(dt);
      draw();
      requestAnimationFrame(loop);
    }

    requestAnimationFrame(loop);
  </script>
</body>
</html>
